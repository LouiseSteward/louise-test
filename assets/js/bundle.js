---
layout: null
# Note that epub output loads _epub/js/bundle.js
---

{% include metadata %}

{% include_relative polyfills.min.js %}
{% include_relative utilities.js %}
{% include_relative settings.js %}
{% include_relative metadata.js %}
{% include_relative locales.js %}

{% if site.output == "web" or site.output == "app" %}
    {% include_relative setup.js %}
    {% include_relative nav.min.js %}
    {% include_relative get-query-variable.min.js %}
    {% include_relative mark.min.js %}
    {% include_relative mark-search-terms.min.js %}
    {% include_relative slides.min.js %}
    {% include_relative lazyload.min.js %}
    {% include_relative videos.min.js %}
    {% include_relative expandable-box.min.js %}
    {% include_relative accordions.min.js %}
    {% include_relative tables.min.js %}
    {% include_relative new-tabs.min.js %}
    {% include_relative definitions.min.js %}
    {% include_relative footnotes.min.js %}
    {% include_relative mcqs.min.js %}
    {% include_relative sidenotes.min.js %}
    {% include_relative page-reload.js %}
    {% include_relative citations.js %}
    {% include_relative owid-iframes.js %}
    {% include_relative dark-mode.js %}
    {% include_relative notifications.js %}
    {% include_relative show-hide.js %}
    {% include_relative language-select.js %}
    {% include_relative transcripts.js %}
    {% include_relative login-prompts.js %}

    {% if site.data.settings.web.wordpress-user-profile == true %}
        {% include_relative wordpress-user-profile.js %}
    {% endif %}

    {% if site.data.settings.images.fullscreen == true %}
        {% include_relative bigscreen.min.js %}
        {% include_relative fullscreen-images.js %}
    {% endif %}

    {% if site.data.settings.web.svg.inject == true %}
        {% include_relative vendor/svg-inject.min.js %}
        {% include_relative svg-management.js %}
    {% endif %}
    
    {% include_relative vendor/lodash.core.min.js %}

{% endif %}

{% if site.output == "web" %}
    {% include_relative anchor.min.js %}
    {% include_relative anchor.init.js %}
{% endif %}

{% comment %} Enable bookmarks in _data settings.yml,
and define options in assets/bookmarks.js. This lets us
have different behaviour for web or app. {% endcomment %}
{% if site.output == "web" and site.data.settings.web.bookmarks.enabled == true %}
    {% include_relative bookmarks.js %}
    
    {% if site.data.settings.web.bookmarks.synchronise == true %}
        {% include_relative bookmark-sync.js %}
    {% endif %}
{% elsif site.output == "app" and site.data.settings.app.bookmarks == true %}
    {% include_relative bookmarks.js %}
{% endif %}

{% if site.output == "web" and site.build != "live" and site.data.settings.web.annotator.development == true %}
    {% include_relative annotation.js %}
{% elsif site.output == "web" and site.build == "live" and site.data.settings.web.annotator.live == true %}
    {% include_relative annotation.js %}
{% endif %}

{% if site.data.settings.search-type == "google-cse" and site.output == "web" %}
    {% include_relative google-cse.js %}
{% endif %}

{% if site.output == "print-pdf" or site.output == "screen-pdf" %}

    {% comment %}
    This script gives every heading a title attribute.
    This is useful to Prince, which can use title attributes for running heads.
    By default, we only load it for PDF outputs.
    {% endcomment %}
    {% include_relative heading-titles.min.js %}

    {% comment %}
    This script moves footnotes generated by kramdown from the end of the page
    up to the reference point.
    {% endcomment %}
    {% include_relative footnotes_pdf.js %}

    {% comment %}
    This script detects the page number we're on and provides
    the relevant page cross-reference text as generated content.
    {% endcomment %}
    {% include_relative page-reference.js %}

    {% comment %}
    This script lets us bump en element up the DOM,
    for instance if we want an element to appear in the sidebar
    beside the element that it follows in the DOM.
    {% endcomment %}
    {% include_relative bump.js %}

    {% comment %}
    This script replaces citation ids with citation labels, if the book
    uses a references.yml file. Loaded in bundle.js for non-PDF outputs.
    {% endcomment %}
    {% include_relative citations.js %}

{% endif %}

{% if site.output == "screen-pdf" and site.data.settings.slideline-review == true %}
    {% comment %}We're using this temporarily to create image-review docs
    with screen-pdf output. Removes everything except image divs.{% endcomment %}
    {% include_relative images-only.js %}
{% endif %}


{% comment %}
This script generates a "For instructors' use only" footer in screen-pdfs
{% endcomment %}
{% if site.output == "screen-pdf" %}
    {% include_relative footer-notice.js %}
{% endif %}

{% comment %} For student builds {% endcomment %}
{% if site.audience == "students" %}
    {% include_relative students.js %}
{% endif %}

{% if site.output == "web" %}
    {% comment %} Add analytics tracking after all elements have loaded {% endcomment %}
    {% include_relative analytics.js %}
{% endif %}

{% comment %} Tools for generating and displaying book indexes {% endcomment %}

    {% comment %} Load the ebIndexTargets 'database'. {% endcomment %}
    {% include_relative index-loader.js %}

    {% comment %} Script to turn HTML comments into anchor targets.
    Also handled by gulp in PDF, epub; but included
    in all outputs so that Puppeteer can index. {% endcomment %}
    {% include_relative index-targets.js %}

    {% comment %} Script that adds index-reference links.
    This is done client-side in web and app, and pre-processed by gulp
    in PDF and epub outputs. {% endcomment %}
    {% if site.output == "web" or site.output == "app" %}
        {% include_relative index-lists.js %}
    {% endif %}

    {% comment %} Add on-page navigation to book indexes. {% endcomment %}
    {% if site.output == "web" or site.output == "app" or site.output == "epub" %}
        {% include_relative index-navigation.js %}
    {% endif %}

{% comment %} Add a check for automated testing {% endcomment %}
{% include_relative bundle-check.js %}
